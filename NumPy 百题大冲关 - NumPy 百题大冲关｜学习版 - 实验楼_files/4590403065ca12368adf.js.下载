(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{1125:function(e,t,n){},1126:function(e,t,n){},1127:function(e,t,n){},1128:function(e,t,n){},1129:function(e,t,n){},1130:function(e,t,n){},1131:function(e,t,n){},1132:function(e,t,n){},1133:function(e,t,n){},1232:function(e,t,n){"use strict";n(13);var r=n(2),o=(n(83),n(95),n(17),n(1136)),c=n.n(o),l={props:{realPrice:{type:Number,default:0},qrcodeUrl:{type:String,default:""},changeChannel:{type:Function,default:null}},watch:{qrcodeUrl:function(e){e&&c.a.toCanvas(this.$refs.qrcode,e)}}},h=(n(1277),n(5)),d=Object(h.a)(l,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"text-center"},[n("p",{staticClass:"vip-wx-price font-18 bold"},[e._v("\n    付款：\n    "),n("span",{staticClass:"color-red"},[e._v("\n      ￥"+e._s(e.realPrice)+"\n    ")])]),e._v(" "),n("div",{staticClass:"vip-wx-qrcode"},[n("canvas",{ref:"qrcode",staticClass:"canvas-qrcode",attrs:{width:"256",height:"256"}})]),e._v(" "),n("p",[e._v("微信扫描二维码完成支付")]),e._v(" "),n("a",{attrs:{href:"javascript:;"},on:{click:e.changeChannel}},[e._v("\n    更换支付方式\n  ")])])},[],!1,null,"44a66f73",null).exports,m={props:{changeChannel:{type:Function,default:null},queryBillStatus:{type:Function,default:null}}},f=(n(1278),Object(h.a)(m,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"text-center"},[n("div",{staticClass:"content-box inline-block"},[n("h4",{staticClass:"text-center color-text"},[e._v("\n      支付确认\n    ")]),e._v(" "),n("br"),e._v(" "),n("div",{staticClass:"checker-group flex"},[n("b-button",{staticClass:"checker paid-success",attrs:{variant:"primary"},on:{click:e.queryBillStatus}},[e._v("\n        支付成功\n      ")]),e._v(" "),n("b-button",{staticClass:"checker",attrs:{variant:"outline-primary"},on:{click:e.changeChannel}},[e._v("\n        选择支付方式\n      ")])],1)])])},[],!1,null,"5922c102",null).exports),v={props:{title:{type:String,required:!0},last:{type:Boolean,default:!1},shrinkable:{type:Boolean,default:!1}},data:function(){return{showBody:!1}},computed:{collapseId:function(){return"collapse-".concat(this.title)}},methods:{toggleShowBody:function(){this.showBody=!this.showBody}}},y=(n(1279),Object(h.a)(v,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"module-section",class:{last:e.last}},[e.shrinkable?n("div",{staticClass:"section-header shrinkable",on:{click:e.toggleShowBody}},[n("span",[e._v(e._s(e.title))]),e._v(" "),n("i",{staticClass:"fa fa-angle-down",class:{active:e.showBody}})]):n("div",{staticClass:"section-header"},[n("span",[e._v(e._s(e.title))])]),e._v(" "),e.shrinkable?n("b-collapse",{attrs:{id:e.collapseId},model:{value:e.showBody,callback:function(t){e.showBody=t},expression:"showBody"}},[n("div",{staticClass:"section-body"},[e._t("section-body")],2)]):n("div",{staticClass:"section-body"},[e._t("section-body")],2)],1)},[],!1,null,"03dae3f2",null).exports),_=n(570),w=n.n(_),C=n(569),x=n.n(C),k={components:{BaseModule:y},props:{setPurchaseDays:{type:Function,required:!0},levelIndex:{type:Number,default:1}},data:function(){return{selected:365,daysOption:[365,730]}},computed:{daysImages:function(){var e=[null,x.a];return 2===this.levelIndex&&e.splice(0,1,w.a),e}},watch:{selected:function(e){this.setPurchaseDays(e)}}},P=(n(1280),Object(h.a)(k,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("base-module",{attrs:{title:"开通时长"}},[n("template",{slot:"section-body"},[n("div",{staticClass:"year-options"},e._l(e.daysOption,function(t,r){return n("div",{key:r,staticClass:"option-btn year-option",class:{active:t===e.selected},on:{click:function(n){e.selected=t}}},[n("span",[e._v(e._s((t/365).toFixed(0))+"年")]),e._v(" "),e.daysImages[r]?n("img",{attrs:{src:e.daysImages[r],alt:"额外赠送天数"}}):e._e()])}),0)])],2)},[],!1,null,"be584dbe",null).exports),N={components:{BaseModule:y},props:{purpose:{type:String,default:"common"},courseId:{type:Number,default:0},updateCoupon:{type:Function,required:!0}},data:function(){return{coupon:"",message:"",queryStatus:!1}},computed:{realPurpose:function(){return"common"===this.purpose?"common":"buy_".concat(this.purpose)}},methods:{queryCoupon:function(){var e=Object(r.a)(regeneratorRuntime.mark(function e(){var t,n,r,data,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.coupon&&this.realPurpose){e.next=2;break}return e.abrupt("return");case 2:return t=this.$urls.verifyCoupon(this.coupon,this.realPurpose,this.courseId),e.next=5,this.$ajax.post(t);case 5:n=e.sent,r=n.ok,data=n.data,o=n.response,r?(this.queryStatus=!0,this.parseCouponInfo(data)):(this.queryStatus=!1,o.data&&this.parseCouponInfo(o.data));case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),parseCouponInfo:function(e){var t=e.price,n=void 0===t?0:t,r=e.message,o=void 0===r?"":r,c=e.percent,l=void 0===c?1:c;this.message=o,this.queryStatus&&this.updateCoupon({price:n,percent:l,coupon:this.coupon})}}},I=(n(1281),Object(h.a)(N,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("base-module",{attrs:{title:"使用优惠码/邀请码",shrinkable:!0}},[n("template",{slot:"section-body"},[n("b-input-group",{staticClass:"input-group-wrapper mb-2",attrs:{size:"sm"}},[n("b-form-input",{model:{value:e.coupon,callback:function(t){e.coupon=t},expression:"coupon"}}),e._v(" "),n("b-input-group-append",[n("b-button",{attrs:{size:"sm",variant:"outline-primary"},on:{click:e.queryCoupon}},[e._v("\n          使用\n        ")])],1)],1),e._v(" "),e.message?n("p",{staticClass:"no-margin",class:[e.queryStatus?"color-primary":"color-red"]},[e._v("\n      "+e._s(e.message)+"\n    ")]):e._e()],1)],2)},[],!1,null,"f8ef626e",null).exports),T={props:{realPrice:{type:Number,default:0},updateFenqiNum:{type:Function,required:!0},interestFreeNum:{type:Number,default:0}},data:function(){return{activePlan:{num:0}}},computed:{pricePlanPerPeriod:function(){var e=this,t=[],n=this.realPrice,r=0,o=0,text="";return[0,3,6,12].map(function(c){r=e.calculateFee(e.realPrice,c),c>0?(text="x ".concat(c," 期"),(n=e.realPrice/c).toFixed(2),o=n+r):(text="不分期",o=e.realPrice),t.push({num:c,text:text,fee:r,price:o.toFixed(2)})}),t}},methods:{calculateFee:function(e,t){if(t<=this.interestFreeNum)return 0;if(0===t)return 0;var n=e*{3:.023,6:.045,12:.075}[t]/t;return+(n=n.toFixed(2))},setActivePlan:function(e){this.activePlan=e,this.updateFenqiNum(e.num)}}},B=(n(1282),{components:{BaseModule:y,AntCreditPayPanel:Object(h.a)(T,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"ant-installment relative"},[r("div",{staticClass:"installment flex space-between"},[e._l(e.pricePlanPerPeriod,function(t,o){return[r("div",{key:o,staticClass:"installment-plan relative",class:{active:t.num===e.activePlan.num},on:{click:function(n){return e.setActivePlan(t)}}},[r("img",{directives:[{name:"show",rawName:"v-show",value:t.num===e.activePlan.num,expression:"plan.num === activePlan.num"}],staticClass:"checked",attrs:{src:n(572),alt:"checked"}}),e._v(" "),r("span",{staticClass:"price"},[e._v("\n          ￥"+e._s(t.price)+"\n        ")]),e._v(" "+e._s(t.text)+"\n      ")])]})],2),e._v(" "),r("p",{staticClass:"selected-plan flex"},[e.activePlan.num?r("span",{staticClass:"fee"},[e._v("\n      已选择\n      "),r("span",{staticClass:"bold"},[e._v("\n        "+e._s(e.activePlan.num)+" 期\n      ")]),e._v(" ， 每期含手续费 "+e._s(e.activePlan.fee)+" 元\n    ")]):r("span",{staticClass:"fee"},[e._v("\n      已选择\n      "),r("span",{staticClass:"bold"},[e._v("\n        不分期\n      ")]),e._v(" ，无手续费\n    ")]),e._v(" "),r("nuxt-link",{staticClass:"inline-block float-right",staticStyle:{color:"#aaa"},attrs:{to:"/questions/88927/",target:"_blank"}},[e._v("\n      使用花呗分期时遇到问题？\n    ")])],1)])},[],!1,null,"25864bd1",null).exports},props:{realPrice:{type:Number,default:0},updateFenqiNum:{type:Function,required:!0},updateChannel:{type:Function,required:!0},interestFreeNum:{type:Number,default:0}},data:function(){return{channles:["ALI_WEB","WX_NATIVE","ANT_CREDIT_PAY"],selectedChannle:"ALI_WEB",fenqiNum:0}},watch:{selectedChannle:function(e){this.updateChannel(e),"ANT_CREDIT_PAY"!==e&&(this.fenqiNum=0)},fenqiNum:function(e){this.updateFenqiNum(e)}},mounted:function(){this.updateChannel(this.selectedChannle)},methods:{updateFenqi:function(e){this.fenqiNum=e}}}),A=(n(1283),Object(h.a)(B,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("base-module",{attrs:{title:"支付方式",last:!0}},[n("template",{slot:"section-body"},[n("div",{staticClass:"payment-channels flex"},[e._l(e.channles,function(t,r){return[n("div",{key:r,staticClass:"channel",class:[t,t===e.selectedChannle?"active":""],on:{click:function(n){e.selectedChannle=t}}})]})],2),e._v(" "),"ANT_CREDIT_PAY"==e.selectedChannle?n("ant-credit-pay-panel",{attrs:{"real-price":e.realPrice,"update-fenqi-num":e.updateFenqi,"interest-free-num":e.interestFreeNum}}):e._e()],1)],2)},[],!1,null,"0881e13f",null).exports),F=n(4),M=n.n(F),S={components:{WxQrcode:d,AlipayChecker:f,DaysModule:P,CouponModule:I,PaymentModule:A},props:{price:{type:Number,default:399},modalTitle:{type:String,default:""},showCoupon:{type:Boolean,default:!0},purchaseType:{type:String,default:"member"},vipLevelIndex:{type:Number,default:1},payHint:{type:String,default:""},needBook:{type:Boolean,default:!1},bookPrice:{type:Number,default:0},courseId:{type:Number,default:0},labId:{type:Number,default:0},successUrl:{type:String,default:""},returnUrl:{type:String,default:""},successMessage:{type:String,default:""},redirectDelay:{type:Number,default:0},daysModule:{type:Boolean,default:!1},purchaseDays:{type:Number,default:365},setPurchaseDays:{type:Function,default:null}},data:function(){return{showModal:!1,channel:"",agreeTerms:!0,fenqiNum:0,interestFreeNum:0,bookMailInfo:{needBook:!0},showBookMailInfo:!1,showAlipayChecker:!1,showWxQrcode:!1,wxQrcodeUrl:"",coupon:"",couponPrice:0,couponPercent:1,billNumber:0,billQueryTimer:null,newTab:null}},computed:{realPrice:function(){if(this.price<0)return this.price;var e=this.price*this.couponPercent-this.couponPrice;return this.bookMailInfo.needBook&&(e+=this.bookPrice),e<0&&(e=0),parseFloat(e.toFixed(2))},purchaseParmas:function(){var data={channel:this.channel,beans:0};switch(this.purchaseType){case"member":data.level=this.vipLevelIndex;break;case"lab":data.buy_start_times=1,data.return_url=window.location.href;break;default:this.needBook?(data.recipient=this.bookMailInfo.recipient,data.recipient_addr=this.bookMailInfo.recipient_addr,data.recipient_phone=this.bookMailInfo.ecipient_phone,data.need_book=!0):data.need_book=!1}return"ANT_CREDIT_PAY"===this.channel&&(data.channel="ALI_WEB"),this.coupon&&(data.coupon_num=this.coupon),this.fenqiNum>0&&(data.fq_num=""+this.fenqiNum),this.returnUrl&&(data.return_url="".concat(location.origin).concat(this.returnUrl)),this.daysModule&&(data.buy_days=this.purchaseDays),data},purchaseUrl:function(){var e="";switch(this.purchaseType){case"member":e=this.$urls.purchaseVip;break;case"lab":e=this.$urls.purchaseLab(this.labId);break;default:e=this.$urls.purchaseCourse(this.courseId)}return e},paymentChannels:function(){return["ALI_WEB","WX_NATIVE","ANT_CHECK_LATER"]},shouldOpenNewTab:function(){return this.realPrice>0&&this.purchaseParmas.channel.includes("ALI")}},watch:{showModal:function(e){this.resetCoupon(),e||365===this.purchaseDays||this.setPurchaseDays(365)}},beforeDestroy:function(){clearInterval(this.billQueryTimer)},mounted:function(){M()().isBetween("2019-11-04 10:00:00","2019-11-13 00:00:00")&&(this.interestFreeNum=6)},methods:{resetCoupon:function(){this.coupon="",this.couponPrice=0,this.couponPercent=1},setBookMailInfo:function(e){this.bookMailInfo=e},setFenqiNum:function(e){this.fenqiNum=e},setChannel:function(e){this.channel=e},setCouponData:function(e){var t=e.coupon,n=e.price,r=e.percent;this.coupon=t,this.couponPrice=n,this.couponPercent=r},purchaseConfirm:function(){this.agreeTerms&&(this.needBook&&this.purchaseParmas.needBook&&!this.purchaseParmas.recipient||this.doPurchase({url:this.purchaseUrl,params:this.purchaseParmas}))},doPurchase:function(){var e=Object(r.a)(regeneratorRuntime.mark(function e(t){var n,r,o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.url,r=t.params,this.shouldOpenNewTab&&(this.newTab=window.open()),this.$ajax.post(n,r).then(function(e){e.ok?e.data.need_pay?o.handleResponse(e.data):(o.$showMessage("success",o.successMessage||"支付成功"),o.successUrl?o.redirectDelay?setTimeout(function(){location.href=o.successUrl},+o.redirectDelay):location.href=o.successUrl:location.reload()):(o.$actionMessage(!1,e.response.data.message,!1,"",""),o.shouldOpenNewTab&&o.newTab&&o.newTab.close())});case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),changeChannel:function(){this.showAlipayChecker=!1,this.showWxQrcode=!1,clearInterval(this.billQueryTimer)},handleResponse:function(e){if(this.billNumber=e.bill_number,e.alipay_form){var t=document.createElement("div");t.innerHTML=e.alipay_form;var form=t.querySelector("form");form.setAttribute("charset","utf-8"),form.setAttribute("accept-charset","utf-8"),this.newTab.document.body.append(t),this.newTab.document.forms.alipaysubmit.submit(),this.showAlipayChecker=!0}else e.url||e.wx_wap_url?this.newTab.location.href=e.url||e.wx_wap_url:(this.showWxQrcode=!0,this.wxQrcodeUrl=e.wx_qrcode_url,this.queryWxBillStatus())},queryWxBillStatus:function(){var e=this;this.billQueryTimer=setInterval(function(){e.queryBillStatus({billNumber:e.billNumber,channel:"wx"})},3e3)},queryAlipayBillStatus:function(){this.queryBillStatus({billNumber:this.billNumber,channel:"alipay"})},queryBillStatus:function(){var e=Object(r.a)(regeneratorRuntime.mark(function e(t){var n,r,o,c,l=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.billNumber,r=t.channel,o=void 0===r?"":r,e.next=3,this.$ajax.get(this.$urls.queryBillStatus(n));case 3:(c=e.sent).ok&&(c.data.is_paid?(this.$showMessage("success",this.successMessage||"支付成功"),this.successUrl?this.redirectDelay?setTimeout(function(){l.$router.push({path:l.successUrl})},+this.redirectDelay):this.$router.push({path:this.successUrl}):location.reload()):"alipay"===o&&(this.$showMessage("danger","支付失败"),location.reload()));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}},$=(n(1284),n(1285),Object(h.a)(S,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-modal",{attrs:{id:"modal-purchase",title:e.modalTitle,size:"lg"},model:{value:e.showModal,callback:function(t){e.showModal=t},expression:"showModal"}},[n("div",{staticClass:"custom-modal-header w-100 vertical-center",attrs:{slot:"modal-header"},slot:"modal-header"},[n("h3",{staticClass:"no-margin"},[e._v("\n      "+e._s(e.modalTitle)+"\n    ")]),e._v(" "),n("button",{staticClass:"close",attrs:{type:"button","aria-label":"Close"},on:{click:function(t){e.showModal=!1}}},[e._v("\n      ×\n    ")])]),e._v(" "),n("div",{ref:"modalContent",staticClass:"custom-modal-content text-left"},[n("wx-qrcode",{directives:[{name:"show",rawName:"v-show",value:e.showWxQrcode,expression:"showWxQrcode"}],attrs:{"qrcode-url":e.wxQrcodeUrl,"bill-number":e.billNumber,"change-channel":e.changeChannel,"real-price":e.realPrice}}),e._v(" "),n("alipay-checker",{directives:[{name:"show",rawName:"v-show",value:e.showAlipayChecker,expression:"showAlipayChecker"}],attrs:{"bill-number":e.billNumber,"query-bill-status":e.queryAlipayBillStatus,"change-channel":e.changeChannel}}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:!e.showWxQrcode&&!e.showAlipayChecker,expression:"!showWxQrcode && !showAlipayChecker"}]},[e.daysModule?n("days-module",{attrs:{"level-index":e.vipLevelIndex,"set-purchase-days":e.setPurchaseDays}}):e._e(),e._v(" "),e.showCoupon?n("coupon-module",{attrs:{"update-coupon":e.setCouponData,purpose:e.purchaseType,"course-id":e.courseId}}):e._e(),e._v(" "),n("payment-module",{attrs:{"real-price":e.realPrice,"update-fenqi-num":e.setFenqiNum,"update-channel":e.setChannel,"interest-free-num":e.interestFreeNum}})],1)],1),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:!e.showWxQrcode&&!e.showAlipayChecker,expression:"!showWxQrcode && !showAlipayChecker"}],staticClass:"custom-modal-footer w-100 flex",attrs:{slot:"modal-footer"},slot:"modal-footer"},[n("div",{staticClass:"box-left"},[n("span",{staticClass:"vertical-middle font-18"},[e._v("\n        付款:\n      ")]),e._v(" "),n("strong",{staticClass:"color-red vertical-middle real-price"},[e._v("\n        "+e._s(e.realPrice>-1?"￥"+e.realPrice:"")+"\n      ")]),e._v(" "),e.payHint?n("p",{staticClass:"pay-hint font-14 color-red"},[e._v("\n        "+e._s(e.payHint)+"\n      ")]):e._e()]),e._v(" "),n("div",{staticClass:"box-right"},[n("b-button",{staticClass:"btn-confirm",class:{disabled:!e.agreeTerms},attrs:{variant:"danger"},on:{click:e.purchaseConfirm}},[e._v("\n        确认购买\n      ")]),e._v(" "),n("div",{staticClass:"checkbox-terms"},[n("b-form-checkbox",{staticClass:"no-margin font-13",attrs:{value:!0,"unchecked-value":!1,plain:""},model:{value:e.agreeTerms,callback:function(t){e.agreeTerms=t},expression:"agreeTerms"}},[e._v("\n          同意\n          "),n("a",{attrs:{href:"/paid_account_terms",target:"_blank"}},[e._v("\n            实验楼用户付费协议\n          ")])])],1)],1)])])},[],!1,null,"1c29ce6c",null));t.a=$.exports},1277:function(e,t,n){"use strict";var r=n(1125);n.n(r).a},1278:function(e,t,n){"use strict";var r=n(1126);n.n(r).a},1279:function(e,t,n){"use strict";var r=n(1127);n.n(r).a},1280:function(e,t,n){"use strict";var r=n(1128);n.n(r).a},1281:function(e,t,n){"use strict";var r=n(1129);n.n(r).a},1282:function(e,t,n){"use strict";var r=n(1130);n.n(r).a},1283:function(e,t,n){"use strict";var r=n(1131);n.n(r).a},1284:function(e,t,n){"use strict";var r=n(1132);n.n(r).a},1285:function(e,t,n){"use strict";var r=n(1133);n.n(r).a}}]);